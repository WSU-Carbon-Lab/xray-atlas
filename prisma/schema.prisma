generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["next_auth", "public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model calibrationmethods {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @unique
  description String?
  experiments experiments[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model collaborators {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  url          String?
  ishost       Boolean  @default(false)
  displayorder Int      @default(0)
  createdat    DateTime @default(now()) @db.Timestamptz(6)
  updatedat    DateTime @default(now()) @db.Timestamptz(6)

  @@index([ishost, displayorder])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model edges {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  targetatom  String
  corestate   String
  experiments experiments[]

  @@unique([targetatom, corestate])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model experimentpublications {
  experimentid  String       @db.Uuid
  publicationid String       @db.Uuid
  role          String       @default("cited")
  experiments   experiments  @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  publications  publications @relation(fields: [publicationid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([experimentid, publicationid])
  @@index([publicationid], map: "idx_experimentpublications_publicationid")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model experimentquality {
  experimentid  String      @id @db.Uuid
  signaltonoise Decimal?    @db.Decimal
  userrating    Int?
  upvotes       Int         @default(0)
  downvotes     Int         @default(0)
  comments      Json?
  lastchecked   DateTime?   @db.Timestamptz(6)
  experiments   experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model experiments {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sampleid               String                   @db.Uuid
  instrumentid           String
  edgeid                 String                   @db.Uuid
  polarizationid         String                   @db.Uuid
  calibrationid          String?                  @db.Uuid
  isstandard             Boolean                  @default(false)
  referencestandard      String?
  measurementdate        DateTime                 @db.Date
  createdby              String?
  createdat              DateTime                 @default(now()) @db.Timestamptz(6)
  updatedat              DateTime                 @default(now()) @db.Timestamptz(6)
  experimenttype         ExperimentType?
  experimentpublications experimentpublications[]
  experimentquality      experimentquality?
  calibrationmethods     calibrationmethods?      @relation(fields: [calibrationid], references: [id], onUpdate: NoAction)
  edges                  edges                    @relation(fields: [edgeid], references: [id], onUpdate: NoAction)
  instruments            instruments              @relation(fields: [instrumentid], references: [id], onUpdate: NoAction)
  polarizations          polarizations            @relation(fields: [polarizationid], references: [id], onUpdate: NoAction)
  samples                samples                  @relation(fields: [sampleid], references: [id], onUpdate: NoAction)
  peaksets               peaksets[]
  spectrumpoints         spectrumpoints[]

  @@unique([sampleid, edgeid, instrumentid, measurementdate])
  @@index([sampleid, edgeid, instrumentid, measurementdate], map: "idx_experiment_lookup")
  @@index([calibrationid], map: "idx_experiments_calibrationid")
  @@index([createdby], map: "idx_experiments_createdby")
  @@index([edgeid], map: "idx_experiments_edgeid")
  @@index([instrumentid], map: "idx_experiments_instrumentid")
  @@index([polarizationid], map: "idx_experiments_polarizationid")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model facilities {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String        @unique
  city         String?
  country      String?
  facilitytype FacilityType
  instruments  instruments[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model instruments {
  id          String        @id
  name        String
  facilityid  String        @db.Uuid
  link        String?
  status      String        @default("active")
  experiments experiments[]
  facilities  facilities    @relation(fields: [facilityid], references: [id], onUpdate: NoAction)

  @@index([facilityid], map: "idx_instruments_facilityid")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model molecules {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  iupacname            String
  inchi                String
  smiles               String
  chemicalformula      String
  casnumber            String?                @unique
  pubchemcid           String?                @unique
  createdat            DateTime               @default(now()) @db.Timestamptz(6)
  updatedat            DateTime               @default(now()) @db.Timestamptz(6)
  imageurl             String?
  createdby            String?
  favoritecount        Int                    @default(0) @map("favorite_count")
  viewcount            Int                    @default(0) @map("view_count")
  moleculesynonyms     moleculesynonyms[]
  samples              samples[]
  moleculecontributors moleculecontributors[]
  moleculefavorites    moleculefavorites[]
  moleculeviews        moleculeviews[]
  moleculetags         moleculetags[]

  @@index([createdby], map: "idx_molecules_createdby")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model moleculesynonyms {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid String    @db.Uuid
  synonym    String
  order      Int       @default(0)
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([moleculeid, synonym])
  @@index([moleculeid, order])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tags {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String         @unique
  slug         String         @unique
  color        String?
  createdat    DateTime       @default(now()) @db.Timestamptz(6)
  moleculetags moleculetags[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model moleculecontributors {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid       String    @map("molecule_id") @db.Uuid
  userid           String    @map("user_id") @db.Uuid
  contributiontype String    @default("contributor") @map("contribution_type")
  contributedat    DateTime  @default(now()) @map("contributed_at") @db.Timestamptz(6)
  molecules        molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user             user      @relation(fields: [userid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([moleculeid, userid])
  @@index([moleculeid])
  @@index([userid])
  @@map("molecule_contributors")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model moleculefavorites {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid String    @map("molecule_id") @db.Uuid
  userid     String    @map("user_id") @db.Uuid
  createdat  DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       user      @relation(fields: [userid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([moleculeid, userid])
  @@index([moleculeid])
  @@index([userid])
  @@map("molecule_favorites")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model moleculeviews {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid String    @map("molecule_id") @db.Uuid
  userid     String?   @map("user_id") @db.Uuid
  viewedat   DateTime  @default(now()) @map("viewed_at") @db.Timestamptz(6)
  sessionid  String?   @map("session_id")
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       user?     @relation(fields: [userid], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@index([moleculeid])
  @@index([userid])
  @@index([moleculeid, userid, sessionid])
  @@map("molecule_views")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model moleculetags {
  moleculeid String    @map("molecule_id") @db.Uuid
  tagid      String    @map("tag_id") @db.Uuid
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tags       tags      @relation(fields: [tagid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([moleculeid, tagid])
  @@index([tagid])
  @@map("molecule_tags")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model peaksets {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  experimentid String      @db.Uuid
  energyev     Float
  intensity    Float?
  bond         String?
  transition   String?
  createdat    DateTime    @default(now()) @db.Timestamptz(6)
  experiments  experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([experimentid])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model polarizations {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  azimuthdeg  Decimal       @db.Decimal
  polardeg    Decimal       @db.Decimal
  experiments experiments[]

  @@index([azimuthdeg, polardeg], map: "idx_polarization_geom")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model publications {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doi                    String                   @unique
  title                  String
  journal                String?
  year                   Int?
  authors                Json?
  metadata               Json?
  experimentpublications experimentpublications[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model samples {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid      String         @db.Uuid
  identifier      String         @unique
  preparationdate DateTime?      @db.Date
  createdat       DateTime       @default(now()) @db.Timestamptz(6)
  updatedat       DateTime       @default(now()) @db.Timestamptz(6)
  vendorid        String?        @db.Uuid
  molecularweight Float?
  processmethod   ProcessMethod?
  solvent         String?
  substrate       String?
  thickness       Float?
  experiments     experiments[]
  molecules       molecules      @relation(fields: [moleculeid], references: [id], onUpdate: NoAction)
  vendors         vendors?       @relation(fields: [vendorid], references: [id], onUpdate: NoAction)

  @@index([moleculeid], map: "idx_samples_moleculeid")
  @@index([vendorid], map: "idx_samples_vendorid")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model spectrumpoints {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  experimentid String      @db.Uuid
  energyev     Float
  rawabs       Float
  processedabs Float?
  i0           Float?
  experiments  experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([experimentid, energyev])
  @@index([experimentid, energyev], map: "idx_spectrum_energy")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model vendors {
  id      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name    String    @unique
  url     String?
  samples samples[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model account {
  id                 String  @id(map: "accounts_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         BigInt?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?
  oauth_token_secret String?
  oauth_token        String?
  userId             String? @db.Uuid
  user               user?   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "accounts_userId_fkey")

  @@unique([provider, providerAccountId], map: "provider_unique")
  @@schema("next_auth")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model session {
  id           String   @id(map: "sessions_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  expires      DateTime @db.Timestamptz(6)
  sessionToken String   @unique(map: "sessiontoken_unique")
  userId       String?  @db.Uuid
  user         user?    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sessions_userId_fkey")

  @@schema("next_auth")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user {
  id                            String                 @id(map: "users_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                          String?
  email                         String?                @unique(map: "email_unique")
  emailVerified                 DateTime?              @db.Timestamptz(6)
  image                         String?
  orcid                         String?
  role                          String                 @default("contributor")
  contributionAgreementAccepted Boolean                @default(false)
  contributionAgreementDate     DateTime?              @db.Timestamptz(6)
  account                       account[]
  session                       session[]
  authenticator                 Authenticator[]
  moleculecontributors          moleculecontributors[]
  moleculefavorites             moleculefavorites[]
  moleculeviews                 moleculeviews[]

  @@index([orcid], map: "users_orcid_idx")
  @@schema("next_auth")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model verificationToken {
  identifier String?
  token      String   @id(map: "verification_tokens_pkey")
  expires    DateTime @db.Timestamptz(6)

  @@unique([token, identifier], map: "token_identifier_unique")
  @@schema("next_auth")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Authenticator {
  id                   String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  credentialID         String  @unique @db.VarChar(1024)
  userId               String  @db.Uuid
  counter              BigInt
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?
  user                 user    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
  @@schema("next_auth")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum CoreLevel {
  K
  L1
  L2
  L3
  M1
  M2
  M3

  @@schema("public")
}

enum ExperimentType {
  TOTAL_ELECTRON_YIELD
  PARTIAL_ELECTRON_YIELD
  FLUORESCENT_YIELD
  TRANSMISSION

  @@schema("public")
}

enum FacilityType {
  SYNCHROTRON
  FREE_ELECTRON_LASER
  LAB_SOURCE

  @@schema("public")
}

enum ProcessMethod {
  DRY
  SOLVENT

  @@schema("public")
}
