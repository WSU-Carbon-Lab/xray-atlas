generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["public", "next_auth"]
}

model calibrationmethods {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @unique
  description String?
  experiments experiments[]

  @@schema("public")
}

model edges {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  targetatom  String
  corestate   String
  experiments experiments[]

  @@unique([targetatom, corestate])
  @@schema("public")
}

model experimentpublications {
  experimentid  String       @db.Uuid
  publicationid String       @db.Uuid
  role          String       @default("cited")
  experiments   experiments  @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  publications  publications @relation(fields: [publicationid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([experimentid, publicationid])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model experimentquality {
  experimentid  String      @id @db.Uuid
  signaltonoise Decimal?    @db.Decimal
  userrating    Int?
  upvotes       Int         @default(0)
  downvotes     Int         @default(0)
  comments      Json?
  lastchecked   DateTime?   @db.Timestamptz(6)
  experiments   experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model experiments {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sampleid               String                   @db.Uuid
  instrumentid           String
  edgeid                 String                   @db.Uuid
  polarizationid         String                   @db.Uuid
  calibrationid          String?                  @db.Uuid
  isstandard             Boolean                  @default(false)
  referencestandard      String?
  measurementdate        DateTime                 @db.Date
  createdby              String?
  createdat              DateTime                 @default(now()) @db.Timestamptz(6)
  updatedat              DateTime                 @default(now()) @db.Timestamptz(6)
  experimenttype         ExperimentType?
  experimentpublications experimentpublications[]
  experimentquality      experimentquality?
  calibrationmethods     calibrationmethods?      @relation(fields: [calibrationid], references: [id], onUpdate: NoAction)
  users                  users?                   @relation(fields: [createdby], references: [id], onUpdate: NoAction)
  edges                  edges                    @relation(fields: [edgeid], references: [id], onUpdate: NoAction)
  instruments            instruments              @relation(fields: [instrumentid], references: [id], onUpdate: NoAction)
  polarizations          polarizations            @relation(fields: [polarizationid], references: [id], onUpdate: NoAction)
  samples                samples                  @relation(fields: [sampleid], references: [id], onUpdate: NoAction)
  peaksets               peaksets[]
  spectrumpoints         spectrumpoints[]

  @@unique([sampleid, edgeid, instrumentid, measurementdate])
  @@index([sampleid, edgeid, instrumentid, measurementdate], map: "idx_experiment_lookup")
  @@schema("public")
}

model facilities {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String        @unique
  city         String?
  country      String?
  facilitytype FacilityType
  instruments  instruments[]

  @@schema("public")
}

model instruments {
  id          String        @id
  name        String
  facilityid  String        @db.Uuid
  link        String?
  status      String        @default("active")
  experiments experiments[]
  facilities  facilities    @relation(fields: [facilityid], references: [id], onUpdate: NoAction)

  @@schema("public")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model molecules {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  iupacname        String
  inchi            String
  smiles           String
  chemicalformula  String
  casnumber        String?            @unique
  pubchemcid       String?            @unique
  createdat        DateTime           @default(now()) @db.Timestamptz(6)
  updatedat        DateTime           @default(now()) @db.Timestamptz(6)
  imageurl         String?
  createdby        String?
  upvotes          Int                @default(0)
  users            users?             @relation(fields: [createdby], references: [id], onUpdate: NoAction)
  moleculesynonyms moleculesynonyms[]
  moleculeupvotes  moleculeupvotes[]
  samples          samples[]

  @@schema("public")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model moleculesynonyms {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid String    @db.Uuid
  synonym    String
  order      Int       @default(0)
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([moleculeid, synonym])
  @@index([moleculeid, order])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model polarizations {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  azimuthdeg  Decimal       @db.Decimal
  polardeg    Decimal       @db.Decimal
  experiments experiments[]

  @@index([azimuthdeg, polardeg], map: "idx_polarization_geom")
  @@schema("public")
}

model publications {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doi                    String                   @unique
  title                  String
  journal                String?
  year                   Int?
  authors                Json?
  metadata               Json?
  experimentpublications experimentpublications[]

  @@schema("public")
}

model samples {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  moleculeid      String         @db.Uuid
  identifier      String         @unique
  preparationdate DateTime?      @db.Date
  createdat       DateTime       @default(now()) @db.Timestamptz(6)
  updatedat       DateTime       @default(now()) @db.Timestamptz(6)
  vendorid        String?        @db.Uuid
  molecularweight Float?
  processmethod   ProcessMethod?
  solvent         String?
  substrate       String?
  thickness       Float?
  experiments     experiments[]
  molecules       molecules      @relation(fields: [moleculeid], references: [id], onUpdate: NoAction)
  vendors         vendors?       @relation(fields: [vendorid], references: [id], onUpdate: NoAction)

  @@schema("public")
}

model spectrumpoints {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  experimentid String      @db.Uuid
  energyev     Float
  rawabs       Float
  processedabs Float?
  i0           Float?
  experiments  experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([experimentid, energyev])
  @@index([experimentid, energyev], map: "idx_spectrum_energy")
  @@schema("public")
}

model users {
  id                            String            @id
  name                          String
  email                         String            @unique
  imageurl                      String?
  orcid                         String?           @unique(map: "idx_user_orcid")
  role                          String            @default("contributor")
  clerkid                       String?           @unique
  nextAuthId                    String?           @unique @map("nextAuthId") @db.Uuid
  migratedAt                    DateTime?         @db.Timestamptz(6)
  contributionAgreementAccepted Boolean           @default(false)
  contributionAgreementDate     DateTime?         @db.Timestamptz(6)
  experiments                   experiments[]
  molecules                     molecules[]
  moleculeupvotes               moleculeupvotes[]

  @@schema("public")
}

model moleculeupvotes {
  moleculeid String    @db.Uuid
  userid     String
  createdat  DateTime  @default(now()) @db.Timestamptz(6)
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  molecules  molecules @relation(fields: [moleculeid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [userid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([moleculeid, userid])
  @@index([moleculeid])
  @@index([userid])
  @@schema("public")
}

model vendors {
  id      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name    String    @unique
  url     String?
  samples samples[]

  @@schema("public")
}

model peaksets {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  experimentid String      @db.Uuid
  energyev     Float
  intensity    Float?
  bond         String?
  transition   String?
  createdat    DateTime    @default(now()) @db.Timestamptz(6)
  experiments  experiments @relation(fields: [experimentid], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([experimentid])
  @@schema("public")
}

model collaborators {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  url          String?
  ishost       Boolean  @default(false)
  displayorder Int      @default(0)
  createdat    DateTime @default(now()) @db.Timestamptz(6)
  updatedat    DateTime @default(now()) @db.Timestamptz(6)

  @@index([ishost, displayorder])
  @@schema("public")
}

model NextAuthUser {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String?
  email         String?   @unique @map("email")
  emailVerified DateTime? @map("emailVerified") @db.Timestamptz
  image         String?

  accounts NextAuthAccount[]
  sessions NextAuthSession[]

  @@map("users")
  @@schema("next_auth")
}

model NextAuthAccount {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String        @map("userId") @db.Uuid
  type              String
  provider          String
  providerAccountId String        @map("providerAccountId")
  refresh_token     String?       @db.Text
  access_token      String?       @db.Text
  expires_at        BigInt?
  token_type        String?
  scope             String?
  id_token          String?       @db.Text
  session_state     String?
  oauth_token_secret String?      @map("oauth_token_secret")
  oauth_token       String?       @map("oauth_token")

  user NextAuthUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId], map: "provider_unique")
  @@map("accounts")
  @@schema("next_auth")
}

model NextAuthSession {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionToken String        @unique @map("sessionToken")
  userId       String        @map("userId") @db.Uuid
  expires      DateTime      @db.Timestamptz

  user NextAuthUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
  @@schema("next_auth")
}

model NextAuthVerificationToken {
  identifier String
  token      String   @id
  expires    DateTime @db.Timestamptz

  @@unique([token, identifier], map: "token_identifier_unique")
  @@map("verification_tokens")
  @@schema("next_auth")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum CoreLevel {
  K
  L1
  L2
  L3
  M1
  M2
  M3

  @@schema("public")
}

enum FacilityType {
  SYNCHROTRON
  FREE_ELECTRON_LASER
  LAB_SOURCE

  @@schema("public")
}

enum ExperimentType {
  TOTAL_ELECTRON_YIELD
  PARTIAL_ELECTRON_YIELD
  FLUORESCENT_YIELD
  TRANSMISSION

  @@schema("public")
}

enum ProcessMethod {
  DRY
  SOLVENT

  @@schema("public")
}
